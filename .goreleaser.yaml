version: 2
builds:

- id: "kagenti-webhook"
  dir: kagenti-webhook
  main: ./cmd
  binary: kagenti-webhook-manager

  goos:
  - linux
  - darwin
  goarch:
  - amd64
  - arm64

  env:
  - CGO_ENABLED=0

archives:
- ids: [kagenti-webhook]

kos:
  - id: "kagenti-webhook-ko"
    repositories:
    - ghcr.io/kagenti/kagenti-extensions/kagenti-webhook
    working_dir: kagenti-webhook
    main: ./cmd
    build: kagenti-webhook
    tags:
      - '{{.Version}}'
      - latest
    bare: true
    preserve_import_paths: false
    base_image: gcr.io/distroless/static:nonroot
    platforms:
      - linux/amd64
      - linux/arm64
    env:
      - CGO_ENABLED=0
release:
  draft: false
  prerelease: auto
  mode: keep-existing
